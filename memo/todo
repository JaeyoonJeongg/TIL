1. insert mapper에
resultType없애고
useGeneratedKeys="true" keyProperty="r_id"
추가

2. ReviewServiceImpl에서
int r_id = reviewMapper.insertReview(review);
로 생성된 r_id값 받아오기

3. 리뷰 생성하면 포인트 추가되는 로직 추가
dao-UserMapper.interface

int updateUserPoint(int u_id, int point);

userMapper.xml

<mapper namespace="com.api.triple.dao.UserMapper">

    <select id="getAllUserList" resultType="com.api.triple.dto.User">
        SELECT u_id,
               u_name,
               point
        FROM user;
    </select>

    <update id="updateUserPoint" parameterType="com.api.triple.dto.User">
        UPDATE user
        SET
            point = #{point}
        WHERE
            u_id = #{u_id};
    </update>

</mapper>

4. 장소에 리뷰 몇개인지 검색
ReviewMapper.xml
//장소 리뷰 개수 검색
<select id="findReviewCntByPid" resultType="int" parameterType="int">
        SELECT COUNT(*)
        FROM review
        WHERE p_id = #{p_id}
</select>

@Transactional
    @Override
    public int createReview(Review review) {

        Review newReview = new Review();
        int u_id = newReview.getU_id();
        int p_id = newReview.getP_id();
        //장소 첫 리뷰일 때
        if (placeMapper.findReviewCntByPid(p_id)==0){
            userMapper.updateUserPoint(u_id, 3);
        }
        //사진 없는 리뷰일 때
        else {
            if ((newReview.getPhoto_1()==null && newReview.getPhoto_2()==null)
                        &&
                    (newReview.getPhoto_3()==null && newReview.getPhoto_4()==null)) {
                userMapper.updateUserPoint(u_id, 1);
            }
            else {
                userMapper.updateUserPoint(u_id, 2);
            }
        }
        return reviewMapper.reviewDetail(review);
    }

5. Test 작성
ex)
/*
given
 */
Review new Review = Review.builder().u_id(1).p_id("1").content("다시갈래요").build();
/*
when
 */
Review result = reviewMapper.createReview(review);
/*
then
 */
assertThat(result.getContent()).isEqualTo(review.getContent());
사용


6.포인트 증감이력 테이블 추가?
u_id / p_id / r_id / cud_flag / point

7.
리뷰
생성할때
- 장소의 첫 리뷰인지
- 글만있는지/ 사진도있는지

수정할때
- 사진 추가했는지/ 사진 삭제했는지

삭제할때
- r_id로 검색해서 point 점수 그대로 삭제

8.인덱스

9. Event dto 추가

POST / events
{
String type: "REVIEW"
String Action: "ADD", "MOD", "DELETE"
String reviewId
String content
List<String> attachedPhotoIds
String userId
String placeId
}

EventService, EventServiceImpl 생성
